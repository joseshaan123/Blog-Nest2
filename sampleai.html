<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Smart Text Tools</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 40px;
            line-height: 1.7;
        }

        #popupMenu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            padding: 8px;
            display: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            z-index: 9999;
        }

        #popupMenu button {
            padding: 6px 10px;
            margin: 2px;
            border: none;
            background: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        #popupMenu button:hover {
            background: #0056b3;
        }

        #resultBox {
            margin-top: 30px;
            padding: 20px;
            border-radius: 6px;
            background: #f5f5f5;
            display: none;
            white-space: pre-wrap;
        }
    </style>
</head>

<body>

<h2>Sample Blog Paragraph</h2>

<p id="blogText">
    This is a demo paragraph for testing. Feel free to select any sentence you want. 
    The popup menu will appear above the selected text, and you can fix grammar or rephrase the sentence using Gemini.
</p>

<div id="popupMenu">
    <button id="fixGrammarBtn">Fix Grammar</button>
    <button id="rephraseBtn">Rephrase</button>
</div>

<div id="resultBox"></div>

<script>
    const popup = document.getElementById("popupMenu");
    const resultBox = document.getElementById("resultBox");

    document.addEventListener("mouseup", function () {
        let selection = window.getSelection();
        let text = selection.toString().trim();

        if (text.length > 0) {
            let range = selection.getRangeAt(0);
            let rect = range.getBoundingClientRect();

            popup.style.left = rect.left + window.scrollX + "px";
            popup.style.top = rect.top + window.scrollY - 40 + "px";

            popup.style.display = "block";
        } else {
            popup.style.display = "none";
        }
    });

    async function callGemini(promptText) {
        const apiKey = "AIzaSyAA2czTH5OjbEqJPy7OOLxDLRAtVvz7lAE";  // <-- Replace with your Gemini 2.5 API key

        const response = await fetch(
            "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=" + apiKey,
            {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [
                        {
                            parts: [{ text: promptText }]
                        }
                    ]
                })
            }
        );

        const data = await response.json();
        
        try {
            return data?.candidates[0]?.content?.parts[0]?.text || "No response.";
        } catch (e) {
            return "Error: " + JSON.stringify(data);
        }
    }

    document.getElementById("fixGrammarBtn").onclick = async function () {
        let selected = window.getSelection().toString();
        popup.style.display = "none";

        resultBox.style.display = "block";
        resultBox.innerHTML = "Working on grammar…";

        let output = await callGemini("Fix the grammar of this sentence only: " + selected);
        resultBox.innerHTML = "<b>Grammar Fixed:</b><br><br>" + output;
    };

    document.getElementById("rephraseBtn").onclick = async function () {
        let selected = window.getSelection().toString();
        popup.style.display = "none";

        resultBox.style.display = "block";
        resultBox.innerHTML = "Rephrasing…";

        let output = await callGemini("Rephrase this sentence in a clean and natural way: " + selected);
        resultBox.innerHTML = "<b>Rephrased Sentence:</b><br><br>" + output;
    };
</script>

</body>
</html>
