<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="signin.css">
</head>
<body>
      <header>
    <h1>BLOG<br>NEST</h1>
    <nav>
    <a href="" class="hideOnMobile"><button class="headerbtn" id="head1" >login</button></a>
    <a href="" class="hideOnMobile"><button class="headerbtn" id="head2" >Sign up</button></a>
    <a href="" class="hideOnMobile"><button class="headerbtn" id="head3" >About Us</button></a>
    <a href="" class="hideOnMobile"><button class="headerbtn" id="head4" >Contact Us</button></a>
    <a href="#" ><button  class="menubutton" onclick=showSidebar()><svg xmlns="http://www.w3.org/2000/svg" height="24" width="40" viewBox="0 0 24 24" fill="currentColor">
  <path d="M3 6h18a1 1 0 0 0 0-2H3a1 1 0 0 0 0 2zm18 5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2zm0 7H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2z"/>
</svg>

</button>
</a>
    </nav>
    </header>
    <nav class="sidebar">
     <a href="#"  onclick=hideSidebar()><svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24" fill="currentColor">
      <path d="M18.3 5.71a1 1 0 0 0-1.41 0L12 10.59 7.11 5.7A1 1 0 1 0 5.7 7.11L10.59 12l-4.9 4.89a1 1 0 1 0 1.41 1.41L12 13.41l4.89 4.9a1 1 0 0 0 1.41-1.42L13.41 12l4.89-4.89a1 1 0 0 0 0-1.4z"/>
    </svg></a>
    <a href=""><button class="headerbtn" id="head1">login</button></a>
    <a href=""><button class="headerbtn" id="head2">Sign up</button></a>
    <a href=""><button class="headerbtn" id="head2">About Us</button></a>
    <a href=""><button class="headerbtn" id="head2">Contact Us</button></a>
    
    </nav>
  <div class="container">
  <div id="container1">
   <div id="sliding-container">
   <div id="formLogin" onsubmit="login(event)">
    <h1>Login</h1>
   <form id="loginForm">
  <label>Email</label>
  <input id="login-email" type="email" required>

  <label>Password</label>
  <input id="login-password" type="password" required>

  <button type="submit">Login</button>
</form>

    <p>Dont have an account?<a href="#" onclick="displaySignUp()">Sign Up</a></p>
   </div>
   <div id="formSignUp">
    <h1>Sign-Up</h1>
    <form id="signupForm" onsubmit="signup(event)">
  <label>Full Name</label>
  <input type="text" id="full-name" required>

  <label>Email</label>
  <input type="email" id="sign-up-email" required>

  <label>Date of birth</label>
  <input type="date" id="dob" required>

  <label>Username</label>
  <input type="text" id="user-name" required>

  <label>Password</label>
  <input type="password" id="signup-password" required>

  <label>Confirm Password</label>
  <input type="password" id="confirm-signup-password" required>

  <button type="submit">Sign Up</button>
</form>

      <p>Aldready have an account?<a href="#" onclick="displayLogIn()">Log In</a></p>
    </form>
   </div>
   </div>
  </div>
  </div>

  <script >
    const slide= document.getElementById("sliding-container");
    const container1= document.getElementById("container1");

    const hLogin = document.getElementById("formLogin").offsetHeight;
    const hSignUp = document.getElementById("formSignUp").offsetHeight+ hLogin + 10;

    function displaySignUp(){
      slide.style.transform =`translateY(-${formLogin.offsetHeight + 40}px)`;
      container1.style.height =`${formSignUp.offsetHeight}px`;
    }

    function displayLogIn(){
      slide.style.transform =`translateY(0px)`;
      container1.style.height =`${formLogin.offsetHeight}px`;
    }

    container1.style.height = `${formLogin.offsetHeight}px`;

 // SIGN UP
// SIGN UP
async function signup(e) {
  e.preventDefault();

  const fullName = document.getElementById("full-name").value;
  const email = document.getElementById("sign-up-email").value;
  const dob = document.getElementById("dob").value;
  const username = document.getElementById("user-name").value;
  const password = document.getElementById("signup-password").value;
  const confirmPassword = document.getElementById("confirm-signup-password").value;

  if (password !== confirmPassword) {
    alert("Passwords do not match");
    return;
  }

  const res = await fetch("http://localhost:3000/api/auth/signup", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      fullName,
      email,
      dob,
      username,
      password
    })
  });

  const data = await res.json();
  alert(data.message);
}

// LOGIN
async function login(e) {
  e.preventDefault();

  const emailInput = document.getElementById("login-email").value;
  const passwordInput = document.getElementById("login-password").value;

  const res = await fetch("http://localhost:3000/api/auth/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email: emailInput, password: passwordInput })
  });

  const data = await res.json();

  if (!res.ok) {
    alert(data.message);
    return;
  }

  // IMPORTANT: Clear the old user data first to prevent "ghost" data
  localStorage.clear();

  // Save the NEW user data exactly as it comes from the database
  localStorage.setItem("userId", data.user._id);
  localStorage.setItem("username", data.user.username);
  localStorage.setItem("email", data.user.email); // <--- This must come from data.user

  window.location.href = "profile.html";
}








  </script>
</body>
</html>